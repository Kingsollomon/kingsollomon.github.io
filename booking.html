<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Luxporter Booking Widget</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f9f9f9;
      padding: 20px;
    }
    .widget {
      max-width: 600px;
      margin: auto;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }
    .field { margin-bottom: 15px; }
    label { display: block; font-weight: 600; margin-bottom: 5px; }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .vehicle-preview img {
      width: 100%;
      max-height: 200px;
      object-fit: cover;
      border-radius: 8px;
      margin-top: 10px;
    }
    button {
      padding: 12px 20px;
      background: #333;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    .success { color: green; font-weight: bold; margin-top: 15px; }
  </style>
</head>
<body>
  <div class="widget">
    <h2>Book Your Ride</h2>
    <div class="field">
      <label for="pickup">Pickup Location</label>
      <input type="text" id="pickup" placeholder="Start typing address...">
    </div>
    <div class="field">
      <label for="dropoff">Drop-off Location</label>
      <input type="text" id="dropoff" placeholder="Start typing address...">
    </div>
    <div class="field">
      <label for="distance">Distance (auto, km)</label>
      <input type="number" id="distance" readonly>
    </div>
    <div class="field">
      <label for="time">Estimated Time (auto, mins)</label>
      <input type="number" id="time" readonly>
    </div>
    <div class="field">
      <label for="vehicleType">Vehicle Type</label>
      <select id="vehicleType" onchange="updateVehiclePreview()">
        <option value="sedan">Sedan</option>
        <option value="suv">SUV</option>
        <option value="van">Van</option>
      </select>
    </div>
    <div class="field">
      <label for="vehicleClass">Vehicle Class</label>
      <select id="vehicleClass">
        <option value="economy">Economy</option>
        <option value="business">Business</option>
        <option value="luxury">Luxury</option>
      </select>
    </div>
    <div class="vehicle-preview" id="vehiclePreview"></div>
    <div class="field">
      <strong>Total Price: $<span id="price">0.00</span></strong>
    </div>
    <button onclick="calculateRouteAndPrice()">Calculate</button>
    <div id="payment-buttons"></div>
    <div id="confirmation" class="success"></div>
  </div>

  <script>
    let directionsService;
    let autocompletePickup, autocompleteDropoff;

    function initAutocomplete() {
      directionsService = new google.maps.DirectionsService();
      autocompletePickup = new google.maps.places.Autocomplete(document.getElementById('pickup'));
      autocompleteDropoff = new google.maps.places.Autocomplete(document.getElementById('dropoff'));
    }

    function calculateRouteAndPrice() {
      const pickup = document.getElementById('pickup').value;
      const dropoff = document.getElementById('dropoff').value;
      const type = document.getElementById('vehicleType').value;
      const cls = document.getElementById('vehicleClass').value;

      if (!pickup || !dropoff) {
        alert('Enter both pickup and drop-off locations.');
        return;
      }

      directionsService.route({
        origin: pickup,
        destination: dropoff,
        travelMode: 'DRIVING'
      }, (response, status) => {
        if (status === 'OK') {
          const route = response.routes[0].legs[0];
          const distanceKm = route.distance.value / 1000;
          const durationMin = route.duration.value / 60;

          document.getElementById('distance').value = distanceKm.toFixed(1);
          document.getElementById('time').value = durationMin.toFixed(0);

          let baseRate = 1.0;
          if (type === 'suv') baseRate += 0.5;
          if (type === 'van') baseRate += 1.0;
          if (cls === 'business') baseRate += 1.0;
          if (cls === 'luxury') baseRate += 2.0;

          const price = (distanceKm * 1.5 + durationMin * 0.5) * baseRate;
          document.getElementById('price').textContent = price.toFixed(2);

          showPaymentButtons(price, { pickup, dropoff, distance: distanceKm, time: durationMin, type, cls });
        } else {
          alert('Could not calculate route. Please try again.');
        }
      });
    }

    function updateVehiclePreview() {
      const type = document.getElementById('vehicleType').value;
      const preview = document.getElementById('vehiclePreview');
      const imgMap = {
        sedan: 'https://cdn.pixabay.com/photo/2016/08/11/09/15/car-1589999_1280.png',
        suv:   'https://cdn.pixabay.com/photo/2012/05/29/00/43/suv-49277_1280.jpg',
        van:   'https://cdn.pixabay.com/photo/2013/07/13/14/16/van-162055_1280.png'
      };
      preview.innerHTML = `<img src="${imgMap[type]}" alt="${type}">`;
    }

    window.onload = initAutocomplete;
  </script>
</body>
</html>
