<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>The Luxury Porter | Premier Vancouver Shuttle & Chauffeur</title>
  <meta content="The Luxury Porter – airport transfers and chauffeur services in Vancouver." name="description"/>
  <link href="style.css" rel="stylesheet"/>
  <!-- Inline CSS for responsive fleet & preview images -->
  <style>
    .service-icon {
      width: 200px;
      max-width: 100%;
      height: auto;
      display: block;
      margin: 0 auto 1rem;
    }
    .nav.collapse-nav { display: flex; }
    @media (max-width: 768px) {
      .nav-toggle { display: block; }
      .nav.collapse-nav {
        display: none;
        flex-direction: column;
        width: 100%;
        margin-top: 1rem;
      }
      .nav.collapse-nav.open { display: flex; }
    }
  </style>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBjRgQHuQM5KtOafaJuFgSeh8sFOZk8-4E",
      authDomain: "the-luxporter-79d0e.firebaseapp.com",
      projectId: "the-luxporter-79d0e",
      storageBucket: "the-luxporter-79d0e.appspot.com",
      messagingSenderId: "988733228385",
      appId: "1:988733228385:web:0c5f52530d059d19c37120",
      measurementId: "G-8C1WSFXET0"
    };

    const app = initializeApp(firebaseConfig);
    getAnalytics(app);
    window.__DB__ = getFirestore(app);
  </script>

  <!-- Google Maps & Places API -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDrER52L1EiBYmyU6wDZ-xK9YK5dhtY8_A&libraries=places&callback=initAutocomplete">
  </script>

  <!-- Stripe & PayPal -->
  <script src="https://js.stripe.com/v3/"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=AUV33shO6dasDsZOvQ3hmsD6cEZCjd6i2jGYqvVyTaZnuGdss26Pwz-svq34ZMIir5hkCDvYl__YF1og&currency=USD"></script>
</head>

<body>
  <!-- HEADER -->
  <header class="site-header">
    <div class="container">
      <a class="logo" href="https://theluxuryporter.com">
        <img alt="The Luxury Porter logo" src="assets/logo.png"/>
      </a>
      <button aria-expanded="false" aria-label="Toggle navigation" class="nav-toggle">
        <span class="hamburger"></span>
      </button>
      <nav class="nav collapse-nav">
        <a href="#services">Services</a>
        <a href="#fleet">Fleet</a>
        <a href="#booking">Book Now</a>
        <a href="#contact">Contact</a>
      </nav>
      <div class="contact-info">
        <a href="tel:6045059651">604.505.9651</a>
        <a href="mailto:info@theluxuryporter.com">info@theluxuryporter.com</a>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero" id="hero">
    <div class="container">
      <h1>Ride with Luxury. Travel in Style.</h1>
      <p>Premier airport transfers and chauffeur services in Vancouver.</p>
      <a class="btn btn-primary" href="#booking">Book Your Ride</a>
    </div>
  </section>

  <!-- SERVICES -->
  <section class="section services" id="services">
    <div class="container">
      <h2>Our Services</h2>
      <div class="grid3">
        <div class="card">
          <h3>Airport Transfers</h3>
          <p>On-time pickups and drop-offs at YVR and local heliports.</p>
        </div>
        <div class="card">
          <h3>Corporate Chauffeur</h3>
          <p>Discreet rides for executives and VIPs.</p>
        </div>
        <div class="card">
          <h3>Event Transportation</h3>
          <p>Weddings, conferences, galas – arrive in style.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- FLEET -->
  <section class="section fleet" id="fleet">
    <div class="container">
      <h2>Our Fleet</h2>
      <div class="grid3">
        <div class="vehicle">
          <img alt="Sedan" class="service-icon" src="assets/sedan.png"/>
          <h3>Sedan</h3>
          <p>Up to 3 passengers, refined comfort.</p>
        </div>
        <div class="vehicle">
          <img alt="SUV" class="service-icon" src="assets/SUV.png"/>
          <h3>SUV</h3>
          <p>Up to 6 passengers, spacious luxury.</p>
        </div>
        <div class="vehicle">
          <img alt="Van" class="service-icon" src="assets/Van.png"/>
          <h3>Van</h3>
          <p>Up to 10 passengers, ultimate convenience.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- BOOKING -->
  <section class="section booking" id="booking">
    <div class="container">
      <h2>Book Your Ride</h2>
      <div class="widget">
        <div class="field">
          <label for="pickup">Pickup Location</label>
          <input id="pickup" type="text" placeholder="Start typing address..."/>
        </div>
        <div class="field">
          <label for="dropoff">Drop-off Location</label>
          <input id="dropoff" type="text" placeholder="Start typing address..."/>
        </div>
        <div class="field">
          <label for="passengers">Number of Passengers</label>
          <input id="passengers" type="number" min="1" value="1"/>
        </div>
        <div class="field">
          <label for="bags">Number of Bags</label>
          <input id="bags" type="number" min="0" value="0"/>
        </div>
        <div class="field">
          <label for="pickupDate">Pickup Date</label>
          <input id="pickupDate" type="date"/>
        </div>
        <div class="field">
          <label for="pickupTime">Pickup Time</label>
          <input id="pickupTime" type="time"/>
        </div>
        <div class="field">
          <label for="notes">Additional Notes</label>
          <textarea id="notes" placeholder="Enter any special requests or notes"></textarea>
        </div>
        <div class="field">
          <label for="flight">Flight Number</label>
          <input id="flight" type="text" placeholder="Your flight number"/>
        </div>
        <div class="field">
          <label for="phone">Phone Number</label>
          <input id="phone" type="tel" placeholder="Your phone number"/>
        </div>
        <div class="field">
          <label for="email">Email Address</label>
          <input id="email" type="email" placeholder="Your email address"/>
        </div>
        <div class="field">
          <label for="distance">Distance (km)</label>
          <input id="distance" type="number" readonly/>
        </div>
        <div class="field">
          <label for="time">Estimated Time (mins)</label>
          <input id="time" type="number" readonly/>
        </div>
        <div class="field">
          <label for="vehicleType">Vehicle Type</label>
          <select id="vehicleType">
            <option value="sedan">Sedan</option>
            <option value="suv">SUV</option>
            <option value="van">Van</option>
          </select>
        </div>
        <div class="field">
          <label for="vehicleClass">Vehicle Class</label>
          <select id="vehicleClass">
            <option value="economy">Economy</option>
            <option value="business">Business</option>
            <option value="luxury">Luxury</option>
          </select>
        </div>
        <div class="vehicle-preview" id="vehiclePreview"></div>

        <!-- NEW: Calculate Price Button -->
        <div class="field">
          <button id="calcPriceBtn" class="btn btn-secondary" type="button">
            Calculate Price
          </button>
        </div>

        <!-- PAYMENT SECTION -->
        <div class="field" id="payment-section">
          <strong>Total Price: $<span id="price">0.00</span></strong>
          <div style="margin-top:1rem;">
            <button id="stripeBtn" class="btn btn-primary" type="button">
              Pay with Stripe
            </button>
          </div>
          <div id="paypal-button-container" style="margin-top:1rem;"></div>
        </div>
        <div class="success" id="confirmation"></div>
      </div>
    </div>
  </section>

  <!-- CONTACT -->
  <section class="section contact" id="contact">
    <div class="container">
      <h2>Get in Touch</h2>
      <p>Phone: <a href="tel:6045059651">604.505.9651</a></p>
      <p>Email: <a href="mailto:info@theluxuryporter.com">info@theluxuryporter.com</a></p>
      <p>Web: <a href="https://theluxuryporter.com">theluxuryporter.com</a></p>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="container">
      <p>© 2025 The Luxury Porter. All rights reserved.</p>
    </div>
  </footer>

  <!-- Consolidated Scripts -->
  <script>
    let bookingData = null;
    let calculatedPrice = 0;
    let directionsService;

    // Initialize Google Maps autocomplete & DirectionsService
    function initAutocomplete() {
      directionsService = new google.maps.DirectionsService();
      new google.maps.places.Autocomplete(document.getElementById("pickup"));
      new google.maps.places.Autocomplete(document.getElementById("dropoff"));
    }

    // Update vehicle preview image
    function updateVehiclePreview() {
      const type = document.getElementById("vehicleType").value;
      const map = {
        sedan: "assets/sedan.png",
        suv:   "assets/SUV.png",
        van:   "assets/Van.png"
      };
      document.getElementById("vehiclePreview").innerHTML =
        `<img src="${map[type]}" alt="${type} preview" class="service-icon" />`;
    }
    document.getElementById("vehicleType")
      .addEventListener("change", updateVehiclePreview);
    updateVehiclePreview();

    // Calculate route, price, and prepare bookingData
    async function calculateRouteAndPrice() {
      const pickup     = document.getElementById("pickup").value.trim();
      const dropoff    = document.getElementById("dropoff").value.trim();
      const passengers = +document.getElementById("passengers").value;
      const bags       = +document.getElementById("bags").value;
      const date       = document.getElementById("pickupDate").value;
      const time       = document.getElementById("pickupTime").value;
      const notes      = document.getElementById("notes").value.trim();
      const flight     = document.getElementById("flight").value.trim();
      const phone      = document.getElementById("phone").value.trim();
      const email      = document.getElementById("email").value.trim();
      const type       = document.getElementById("vehicleType").value;
      const cls        = document.getElementById("vehicleClass").value;

      if (!pickup || !dropoff || !date || !time || !flight || !phone || !email) {
        alert("Please fill in all required fields.");
        return;
      }

      directionsService.route({
        origin:      pickup,
        destination: dropoff,
        travelMode:  "DRIVING"
      }, (response, status) => {
        if (status !== "OK") {
          alert("Could not calculate route.");
          return;
        }
        const leg  = response.routes[0].legs[0];
        const km   = leg.distance.value / 1000;
        const mins = leg.duration.value / 60;
        document.getElementById("distance").value = km.toFixed(1);
        document.getElementById("time").value     = mins.toFixed(0);

        let rate = 1;
        if (type === "suv")      rate += 0.5;
        if (type === "van")      rate += 1.0;
        if (cls  === "business") rate += 1.0;
        if (cls  === "luxury")   rate += 2.0;

        const rawPrice = (km * 1.5 + mins * 0.5) * rate * 1.2;
        calculatedPrice = parseFloat(rawPrice.toFixed(2));
        document.getElementById("price").textContent = calculatedPrice.toFixed(2);

        bookingData = {
          pickup, dropoff, passengers, bags, date, time, notes,
          flightNumber: flight, phone, email,
          distance_km: km.toFixed(1), duration_min: mins.toFixed(0),
          vehicleType: type, vehicleClass: cls,
          price: calculatedPrice
        };
      });
    }

    // Submit booking to Firestore
    async function submitBookingToFirebase() {
      if (!bookingData) {
        alert("Please calculate price first.");
        return;
      }
      const { addDoc, collection, serverTimestamp } =
        await import("https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js");
      const db = window.__DB__;
      try {
        await addDoc(collection(db, "bookings"), {
          ...bookingData,
          createdAt: serverTimestamp()
        });
        document.getElementById("confirmation").textContent =
          "🎉 Booking submitted successfully!";
      } catch (err) {
        document.getElementById("confirmation").textContent =
          "🚨 Error: " + err.message;
      }
    }

    // Event listeners for buttons
    document.getElementById("calcPriceBtn")
      .addEventListener("click", calculateRouteAndPrice);


          async function handleStripePayment() {
      if (!bookingData) {
        alert("Please calculate price first.");
        return;
      }
      const stripe = Stripe("pk_live_51LS5HMCqPVUOKHixGsgopn2FWl4rQvh0SIXiVq31W5XGNZmBl6grDzsCrJFWlGu6rGJ7yWrYnlrYysdx2QYDLXlK00DchzzRJo");
      try {
        const response = await fetch(
          "/create-payment-intent",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              amount: Math.round(calculatedPrice * 100)
            })
          }
        );
        const { clientSecret } = await response.json();
        const result = await stripe.confirmCardPayment(clientSecret, {
          payment_method: {
            card: { /* Use Stripe Elements in production */ },
            billing_details: { email: bookingData.email }
          }
        });
        if (result.error) {
          document.getElementById("confirmation").textContent =
            "❌ Payment failed: " + result.error.message;
        } else if (result.paymentIntent.status === "succeeded") {
          await submitBookingToFirebase();
          document.getElementById("confirmation").textContent =
            "🎉 Payment successful and booking saved!";
        }
      } catch (err) {
        document.getElementById("confirmation").textContent =
          "🚨 Error: " + err.message;
      }
    }

    document
      .getElementById("calcPriceBtn")
      .addEventListener("click", calculateRouteAndPrice);

    document
      .getElementById("stripeBtn")
      .addEventListener("click", async () => {
        await calculateRouteAndPrice();
        await handleStripePayment();
      });

    paypal.Buttons({
      createOrder: async (data, actions) => {
        await calculateRouteAndPrice();
        return actions.order.create({
          purchase_units: [{ amount: { value: calculatedPrice.toFixed(2) } }]
        });
      },
      onApprove: async (data, actions) => {
        await actions.order.capture();
        await submitBookingToFirebase();
      },
      onError: (err) => {
        document.getElementById("confirmation").textContent =
          "❌ Payment failed: " + err.message;
      }
    }).render("#paypal-button-container");

    // Collapse-nav toggle
    document.addEventListener('DOMContentLoaded', () => {
      const btn = document.querySelector('.nav-toggle');
      const menu = document.querySelector('.nav.collapse-nav');
      btn.addEventListener('click', () => {
        const isOpen = menu.classList.toggle('open');
        btn.setAttribute('aria-expanded', isOpen);
      });
    });
  </script>
</body>
</html>
